# Base64 Image Storage - Visual Flow Diagram

```
┌─────────────────────────────────────────────────────────────────────┐
│                    BASE64 IMAGE STORAGE SYSTEM                      │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│                        UPLOAD FLOW                                  │
└─────────────────────────────────────────────────────────────────────┘

    ┌──────────────┐
    │ User clicks  │
    │ "Pick Image" │
    └──────┬───────┘
           │
           ▼
    ┌─────────────────────┐
    │ Gallery Picker      │
    │ (ActivityResult)    │
    └──────┬──────────────┘
           │
           ▼
    ┌─────────────────────────────────────┐
    │ User selects image                  │
    │ Returns: Uri (e.g., content://...)  │
    └──────┬──────────────────────────────┘
           │
           ▼
    ┌──────────────────────────────────────────────────┐
    │ Base64ImageHelper.convertUriToBase64()           │
    │                                                  │
    │ 1. Read image from Uri                          │
    │ 2. Decode to Bitmap                             │
    │ 3. Resize to maxSize (800px)                    │
    │ 4. Compress JPEG (75% quality)                  │
    │ 5. Convert to byte array                        │
    │ 6. Encode to Base64 string                      │
    └──────┬───────────────────────────────────────────┘
           │
           ▼
    ┌──────────────────────────────────┐
    │ Validate Size                    │
    │ isBase64SizeValid(base64, 1500)  │
    └──────┬───────────────────────────┘
           │
           ├─────── Too Large ─────┐
           │                       │
           │                       ▼
           │            ┌──────────────────────────┐
           │            │ Retry with lower quality │
           │            │ (600px, 60% quality)     │
           │            └──────────┬───────────────┘
           │                       │
           │                       ├─── Still too large? ───┐
           │                       │                         │
           │                       │                         ▼
           │                       │              ┌────────────────┐
           │                       │              │ Show Error     │
           │                       │              │ "Image too     │
           │                       │              │  large"        │
           │                       │              └────────────────┘
           │                       │
    ┌──────▼───────────────────────▼──────┐
    │ Size OK - Create data map           │
    │ data.put("profileImageBase64", ...) │
    └──────┬──────────────────────────────┘
           │
           ▼
    ┌────────────────────────────────────────┐
    │ Upload to Firebase Firestore           │
    │ db.collection("users")                 │
    │   .document(userId)                    │
    │   .update(data)                        │
    └──────┬─────────────────────────────────┘
           │
           ├─── Success ───┐        ┌─── Failure ───┐
           │               │        │               │
           ▼               ▼        ▼               ▼
    ┌──────────┐   ┌──────────┐  ┌──────────┐  ┌──────────┐
    │ Show     │   │ Display  │  │ Show     │  │ Log      │
    │ "Upload  │   │ Image    │  │ Error    │  │ Error    │
    │ Success" │   │          │  │ Message  │  │          │
    └──────────┘   └──────────┘  └──────────┘  └──────────┘


┌─────────────────────────────────────────────────────────────────────┐
│                       DISPLAY FLOW                                  │
└─────────────────────────────────────────────────────────────────────┘

    ┌──────────────────┐
    │ Activity starts  │
    │ (Dashboard, etc) │
    └──────┬───────────┘
           │
           ▼
    ┌─────────────────────────────────┐
    │ Load user data from Firestore   │
    │ db.collection("users")          │
    │   .document(userId)             │
    │   .get()                        │
    └──────┬──────────────────────────┘
           │
           ▼
    ┌────────────────────────────────────────────┐
    │ Extract image data from document           │
    │ String base64 = doc.getString(             │
    │     "profileImageBase64");                 │
    │ String url = doc.getString(                │
    │     "profileImageUrl");                    │
    └──────┬─────────────────────────────────────┘
           │
           ▼
    ┌──────────────────────────────┐
    │ Check which format exists    │
    └──────┬───────────────────────┘
           │
           ├──── Has Base64? ────┐         ┌──── Has URL? ────┐
           │                     │         │                   │
           │ YES                 │         │ YES               │
           │                     │         │ (Backward compat) │
           ▼                     │         ▼                   │
    ┌──────────────────────┐    │  ┌──────────────────────┐  │
    │ Base64 exists        │    │  │ URL exists           │  │
    └──────┬───────────────┘    │  └──────┬───────────────┘  │
           │                    │         │                   │
           ▼                    │         ▼                   │
    ┌──────────────────────────────┐ ┌────────────────────┐  │
    │ loadBase64IntoImageView      │ │ Glide.load(url)    │  │
    │ WithGlide()                  │ │   .into(imageView) │  │
    │                              │ │                    │  │
    │ 1. Decode Base64 to bytes    │ └────────────────────┘  │
    │ 2. Convert bytes to Bitmap   │                         │
    │ 3. Load with Glide           │                         │
    └──────┬───────────────────────┘                         │
           │                                                  │
           ▼                                                  │
    ┌──────────────────────────────┐                         │
    │ Display in ImageView         │ ◄───────────────────────┘
    └──────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────┐
│                    ARCHITECTURE OVERVIEW                            │
└─────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────┐
│                        PRESENTATION LAYER                          │
├────────────────────────────────────────────────────────────────────┤
│                                                                    │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │ Document        │  │ Edit            │  │ Tutor/Student   │  │
│  │ Verification    │  │ Profile         │  │ Dashboard       │  │
│  │ Activity        │  │ Activity        │  │ Activity        │  │
│  └────────┬────────┘  └────────┬────────┘  └────────┬────────┘  │
│           │                    │                    │            │
└───────────┼────────────────────┼────────────────────┼────────────┘
            │                    │                    │
            └────────────────────┼────────────────────┘
                                 │
┌────────────────────────────────┼────────────────────────────────────┐
│                        UTILITY LAYER                │               │
├─────────────────────────────────────────────────────┼───────────────┤
│                                                     │               │
│              ┌──────────────────────────────────────▼─────────────┐ │
│              │     Base64ImageHelper.java                        │ │
│              │                                                   │ │
│              │  - convertUriToBase64()                          │ │
│              │  - convertBase64ToBitmap()                       │ │
│              │  - loadBase64IntoImageView()                     │ │
│              │  - loadBase64IntoImageViewWithGlide()            │ │
│              │  - isBase64SizeValid()                           │ │
│              │  - getBase64SizeInKB()                           │ │
│              └───────────────────────────────────────────────────┘ │
│                                                                    │
└────────────────────────────────────────────────────────────────────┘
                                 │
                                 │
┌────────────────────────────────┼────────────────────────────────────┐
│                         DATA LAYER                  │               │
├─────────────────────────────────────────────────────┼───────────────┤
│                                                     │               │
│              ┌──────────────────────────────────────▼─────────────┐ │
│              │          Firebase Firestore                       │ │
│              │                                                   │ │
│              │  users/                                           │ │
│              │    {userId}/                                      │ │
│              │      name: "John Doe"                            │ │
│              │      email: "john@example.com"                   │ │
│              │      profileImageBase64: "/9j/4AAQ..."           │ │
│              │      documentImageBase64: "/9j/4AAQ..."          │ │
│              │      profileImageUrl: "https://..." (old)        │ │
│              └───────────────────────────────────────────────────┘ │
│                                                                    │
└────────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────┐
│                   DATA STRUCTURE COMPARISON                         │
└─────────────────────────────────────────────────────────────────────┘

OLD METHOD (Firebase Storage):
──────────────────────────────
┌────────────────────────────┐        ┌─────────────────────────┐
│ Firebase Firestore         │        │ Firebase Storage        │
│                            │        │                         │
│ users/{userId}:            │        │ profile_images/         │
│ {                          │        │   {userId}.jpg          │
│   name: "John"             │        │                         │
│   profileImageUrl: ────────┼────────► gs://bucket/profile... │
│   "https://storage..."     │        │                         │
│ }                          │        │ documents/              │
│                            │        │   {userId}_xyz.jpg      │
└────────────────────────────┘        └─────────────────────────┘

- Requires 2 Firebase services
- Separate billing for Storage
- URL can expire
- Additional network requests


NEW METHOD (Base64 in Firestore):
──────────────────────────────────
┌────────────────────────────────────────┐
│ Firebase Firestore                     │
│                                        │
│ users/{userId}:                        │
│ {                                      │
│   name: "John",                        │
│   email: "john@example.com",           │
│   profileImageBase64: "/9j/4AAQSk...", │
│   documentImageBase64: "/9j/4AAQSk..." │
│ }                                      │
└────────────────────────────────────────┘

- Single Firebase service
- All data in one place
- No URL management
- Atomic updates
- Offline support


┌─────────────────────────────────────────────────────────────────────┐
│                      SIZE OPTIMIZATION                              │
└─────────────────────────────────────────────────────────────────────┘

Original Image:
┌────────────────────────────┐
│ 3000 x 4000 pixels         │
│ Size: ~8MB                 │  ❌ Too large for Firestore
└────────────────────────────┘
              │
              ▼
        Resize to 800px
┌────────────────────────────┐
│ 800 x 1066 pixels          │
│ Size: ~2MB                 │  ❌ Still too large
└────────────────────────────┘
              │
              ▼
    Compress to 75% quality
┌────────────────────────────┐
│ 800 x 1066 pixels          │
│ Size: ~400KB               │  ✅ Perfect!
└────────────────────────────┘
              │
              ▼
      Convert to Base64
┌────────────────────────────┐
│ Base64 String              │
│ Size: ~533KB               │  ✅ Within limits
│ (33% larger than binary)   │
└────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────┐
│               RECOMMENDED IMAGE SPECIFICATIONS                      │
└─────────────────────────────────────────────────────────────────────┘

┌──────────────────┬──────────────┬──────────┬──────────────┐
│ Image Type       │ Max Size     │ Quality  │ Max File Size│
├──────────────────┼──────────────┼──────────┼──────────────┤
│ Profile Picture  │ 800x800 px   │ 75%      │ 1.5 MB       │
│ Document Photo   │ 1200px wide  │ 80%      │ 2 MB         │
│ Thumbnail        │ 300x300 px   │ 60%      │ 500 KB       │
│ Cover Photo      │ 1920px wide  │ 85%      │ 2.5 MB       │
└──────────────────┴──────────────┴──────────┴──────────────┘


┌─────────────────────────────────────────────────────────────────────┐
│                    ERROR HANDLING FLOW                              │
└─────────────────────────────────────────────────────────────────────┘

Upload Attempt
      │
      ▼
┌─────────────────┐
│ Convert to Base64│
└────┬────────────┘
     │
     ├─── Failed? ───┐
     │               │
     │               ▼
     │         ┌──────────────┐
     │         │ Show Error:  │
     │         │ "Failed to   │
     │         │  convert"    │
     │         └──────────────┘
     │
     ▼
┌──────────────────┐
│ Validate Size    │
└────┬─────────────┘
     │
     ├─── Too Large? ───┐
     │                  │
     │                  ▼
     │         ┌─────────────────┐
     │         │ Retry with      │
     │         │ Lower Quality   │
     │         └────┬────────────┘
     │              │
     │              ├─── Still Large? ───┐
     │              │                    │
     │              │                    ▼
     │              │         ┌──────────────────┐
     │              │         │ Show Error:      │
     │              │         │ "Image too large"│
     │              │         └──────────────────┘
     │              │
     ▼              ▼
┌──────────────────────┐
│ Upload to Firestore  │
└────┬─────────────────┘
     │
     ├─── Network Error? ───┐
     │                      │
     │                      ▼
     │              ┌─────────────────┐
     │              │ Show Error:     │
     │              │ "Upload failed" │
     │              │ + Retry Button  │
     │              └─────────────────┘
     │
     ▼
┌──────────────┐
│ Success!     │
│ Display Image│
└──────────────┘
```
